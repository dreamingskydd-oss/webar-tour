<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>AR å°è¦½ - Android å„ªåŒ–ç‰ˆ</title>
  
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
  
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    
    #hint {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 15px 30px;
      border-radius: 25px;
      z-index: 100;
      font-family: Arial;
      font-size: 16px;
    }
    
    #controls {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.85);
      color: white;
      padding: 15px;
      border-radius: 10px;
      font-family: Arial;
      font-size: 14px;
      z-index: 200;
      max-width: 200px;
      display: none;
    }
    
    #controls.visible {
      display: block;
    }
    
    #controls button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 8px 12px;
      margin: 3px;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
      width: 45px;
    }
    
    #controls button:active {
      background: #45a049;
      transform: scale(0.95);
    }
    
    #toggle-btn {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 18px;
      z-index: 201;
      cursor: pointer;
    }
    
    #info {
      position: fixed;
      bottom: 70px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 11px;
      z-index: 100;
      max-width: 200px;
    }
  </style>
</head>
<body>
  
  <!-- æç¤ºè¨Šæ¯ -->
  <div id="hint">ğŸ“· å°æº–å°è¦½æ¨™èªŒ</div>
  
  <!-- èª¿æ•´æŒ‰éˆ• -->
  <button id="toggle-btn">âš™ï¸</button>
  
  <!-- æ§åˆ¶é¢æ¿ -->
  <div id="controls">
    <div style="margin-bottom: 10px; font-weight: bold;">ä½ç½®èª¿æ•´</div>
    <div style="text-align: center;">
      <button onclick="adjustPos('up')">â¬†ï¸</button>
    </div>
    <div style="text-align: center;">
      <button onclick="adjustPos('left')">â¬…ï¸</button>
      <button onclick="adjustPos('right')">â¡ï¸</button>
    </div>
    <div style="text-align: center;">
      <button onclick="adjustPos('down')">â¬‡ï¸</button>
    </div>
    <div style="margin: 10px 0; text-align: center;">
      <button onclick="adjustPos('closer')" style="width: auto; padding: 8px 15px;">é è¿‘</button>
      <button onclick="adjustPos('farther')" style="width: auto; padding: 8px 15px;">é é›¢</button>
    </div>
    <hr style="border: 1px solid #555; margin: 10px 0;">
    <div style="margin-bottom: 10px; font-weight: bold;">å¤§å°èª¿æ•´</div>
    <div style="text-align: center;">
      <button onclick="adjustScale('bigger')" style="width: auto; padding: 8px 15px;">æ”¾å¤§</button>
      <button onclick="adjustScale('smaller')" style="width: auto; padding: 8px 15px;">ç¸®å°</button>
    </div>
    <hr style="border: 1px solid #555; margin: 10px 0;">
    <button onclick="resetPos()" style="width: 100%; background: #FF5722;">ğŸ”„ é‡ç½®</button>
    <button onclick="saveSettings()" style="width: 100%; background: #2196F3; margin-top: 5px;">ğŸ’¾ å„²å­˜</button>
  </div>
  
  <!-- é™¤éŒ¯è³‡è¨Š -->
  <div id="info">
    è¼‰å…¥ä¸­...
  </div>

  <!-- AR å ´æ™¯ -->
  <a-scene
    mindar-image="
      imageTargetSrc: https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/image-tracking/assets/card-example/card.mind;
      autoStart: true;
      filterMinCF: 0.0001;
      filterBeta: 0.01;
    "
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true;">

    <a-assets>
      <video 
        id="vid"
        src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
        preload="auto"
        loop="true"
        muted="true"
        crossorigin="anonymous"
        playsinline
        webkit-playsinline>
      </video>
    </a-assets>

    <a-camera 
      position="0 0 0"
      look-controls="enabled: false">
    </a-camera>

    <a-entity mindar-image-target="targetIndex: 0">
      
      <!-- AR å½±ç‰‡ -->
      <a-video 
        id="ar-video"
        src="#vid" 
        position="0 0 0" 
        width="1" 
        height="0.552">
      </a-video>

      <!-- æ¨™é¡Œæ–‡å­— -->
      <a-text 
        value="AR æ¸¬è©¦" 
        position="0 0.7 0.01" 
        align="center" 
        color="#FFD700" 
        width="1.5"
        shader="flat">
      </a-text>

    </a-entity>
  </a-scene>

  <script>
    // === è¨­å‚™åµæ¸¬ ===
    const isAndroid = /Android/i.test(navigator.userAgent);
    const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    const userAgent = navigator.userAgent.toLowerCase();
    
    // åµæ¸¬ç‰¹å®šå“ç‰Œ
    const deviceInfo = {
      isAndroid: isAndroid,
      isIOS: isIOS,
      isSamsung: userAgent.includes('samsung'),
      isXiaomi: userAgent.includes('xiaomi') || userAgent.includes('redmi'),
      isOPPO: userAgent.includes('oppo'),
      isHuawei: userAgent.includes('huawei'),
      isVivo: userAgent.includes('vivo'),
      screenWidth: window.innerWidth,
      screenHeight: window.innerHeight,
      aspectRatio: (window.innerWidth / window.innerHeight).toFixed(2),
      pixelRatio: window.devicePixelRatio
    };
    
    console.log('è¨­å‚™è³‡è¨Š:', deviceInfo);
    
    // === é è¨­èª¿æ•´åƒæ•¸ ===
    let adjustments = {
      position: { x: 0, y: 0, z: 0 },
      scale: { x: 1, y: 1, z: 1 }
    };
    
    // æ ¹æ“šè¨­å‚™é¡å‹é è¨­èª¿æ•´
    if (deviceInfo.isAndroid) {
      const ratio = parseFloat(deviceInfo.aspectRatio);
      
      if (deviceInfo.isSamsung) {
        // Samsung è¨­å‚™
        adjustments.position.y = -0.05;
        adjustments.position.z = 0.02;
        console.log('å¥—ç”¨ Samsung é è¨­èª¿æ•´');
      } else if (deviceInfo.isXiaomi) {
        // Xiaomi è¨­å‚™
        adjustments.position.y = -0.03;
        adjustments.scale = { x: 0.95, y: 0.95, z: 0.95 };
        console.log('å¥—ç”¨ Xiaomi é è¨­èª¿æ•´');
      } else if (deviceInfo.isOPPO || deviceInfo.isVivo) {
        // OPPO/Vivo è¨­å‚™
        adjustments.position.y = -0.04;
        console.log('å¥—ç”¨ OPPO/Vivo é è¨­èª¿æ•´');
      } else if (ratio < 0.55) {
        // è¶…é•·è¢å¹• (20:9, 21:9)
        adjustments.position.y = -0.08;
        adjustments.scale = { x: 0.9, y: 0.9, z: 0.9 };
        console.log('å¥—ç”¨é•·è¢å¹•èª¿æ•´');
      } else if (ratio < 0.6) {
        // é•·è¢å¹• (19.5:9, 19:9)
        adjustments.position.y = -0.05;
        adjustments.scale = { x: 0.95, y: 0.95, z: 0.95 };
        console.log('å¥—ç”¨ä¸­é•·è¢å¹•èª¿æ•´');
      } else {
        // æ¨™æº–è¢å¹• (18:9, 16:9)
        adjustments.position.y = -0.02;
        console.log('å¥—ç”¨æ¨™æº–è¢å¹•èª¿æ•´');
      }
    }
    
    // è¼‰å…¥å„²å­˜çš„è¨­å®š
    const savedSettings = localStorage.getItem('ar-adjustments');
    if (savedSettings) {
      adjustments = JSON.parse(savedSettings);
      console.log('è¼‰å…¥å„²å­˜çš„è¨­å®š:', adjustments);
    }
    
    // === åˆå§‹åŒ– AR ===
    const scene = document.querySelector('a-scene');
    
    function initAR() {
      console.log('åˆå§‹åŒ– AR...');
      
      const hint = document.getElementById('hint');
      const target = document.querySelector('[mindar-image-target]');
      const video = document.querySelector('#vid');
      const arVideo = document.querySelector('#ar-video');
      const info = document.getElementById('info');
      
      if (!hint || !target || !video || !arVideo) {
        console.error('å…ƒç´ æœªæ‰¾åˆ°');
        return;
      }
      
      // å¥—ç”¨åˆå§‹èª¿æ•´
      applyAdjustments();
      
      // æ›´æ–°è³‡è¨Šé¡¯ç¤º
      updateInfo();
      
      // AR è¿½è¹¤äº‹ä»¶
      target.addEventListener('targetFound', () => {
        console.log('âœ… æ‰¾åˆ°æ¨™è¨˜ï¼');
        hint.style.display = 'none';
        
        video.muted = true;
        video.play().then(() => {
          console.log('âœ… å½±ç‰‡æ’­æ”¾');
        }).catch(err => {
          console.error('âŒ æ’­æ”¾å¤±æ•—:', err);
        });
      });
      
      target.addEventListener('targetLost', () => {
        console.log('âŒ æ¨™è¨˜éºå¤±');
        hint.style.display = 'block';
        video.pause();
      });
      
      console.log('âœ… AR åˆå§‹åŒ–å®Œæˆ');
    }
    
    // å ´æ™¯è¼‰å…¥
    if (scene.hasLoaded) {
      initAR();
    } else {
      scene.addEventListener('loaded', initAR);
    }
    
    // === èª¿æ•´å‡½æ•¸ ===
    function applyAdjustments() {
      const arVideo = document.querySelector('#ar-video');
      if (!arVideo) return;
      
      arVideo.setAttribute('position', adjustments.position);
      arVideo.setAttribute('scale', adjustments.scale);
      
      console.log('å¥—ç”¨èª¿æ•´:', adjustments);
      updateInfo();
    }
    
    function adjustPos(direction) {
      const step = 0.03;
      
      switch(direction) {
        case 'up':
          adjustments.position.y += step;
          break;
        case 'down':
          adjustments.position.y -= step;
          break;
        case 'left':
          adjustments.position.x -= step;
          break;
        case 'right':
          adjustments.position.x += step;
          break;
        case 'closer':
          adjustments.position.z += step;
          break;
        case 'farther':
          adjustments.position.z -= step;
          break;
      }
      
      applyAdjustments();
    }
    
    function adjustScale(direction) {
      const factor = direction === 'bigger' ? 1.05 : 0.95;
      
      adjustments.scale.x *= factor;
      adjustments.scale.y *= factor;
      adjustments.scale.z *= factor;
      
      applyAdjustments();
    }
    
    function resetPos() {
      adjustments = {
        position: { x: 0, y: 0, z: 0 },
        scale: { x: 1, y: 1, z: 1 }
      };
      
      applyAdjustments();
      console.log('å·²é‡ç½®');
    }
    
    function saveSettings() {
      localStorage.setItem('ar-adjustments', JSON.stringify(adjustments));
      alert('è¨­å®šå·²å„²å­˜ï¼');
      console.log('è¨­å®šå·²å„²å­˜');
    }
    
    function updateInfo() {
      const info = document.getElementById('info');
      if (!info) return;
      
      const pos = adjustments.position;
      const scale = adjustments.scale;
      
      info.innerHTML = `
        <strong>è¨­å‚™:</strong> ${deviceInfo.isAndroid ? 'Android' : deviceInfo.isIOS ? 'iOS' : 'å…¶ä»–'}<br>
        <strong>è¢å¹•:</strong> ${deviceInfo.screenWidth}x${deviceInfo.screenHeight}<br>
        <strong>æ¯”ä¾‹:</strong> ${deviceInfo.aspectRatio}<br>
        <strong>ä½ç½®:</strong><br>
        X: ${pos.x.toFixed(2)}<br>
        Y: ${pos.y.toFixed(2)}<br>
        Z: ${pos.z.toFixed(2)}<br>
        <strong>å¤§å°:</strong> ${scale.x.toFixed(2)}
      `;
    }
    
    // === UI æ§åˆ¶ ===
    document.getElementById('toggle-btn').addEventListener('click', () => {
      document.getElementById('controls').classList.toggle('visible');
    });
    
    // éŒ¯èª¤è™•ç†
    window.addEventListener('error', (e) => {
      console.error('éŒ¯èª¤:', e);
    });
  </script>

</body>
</html>
