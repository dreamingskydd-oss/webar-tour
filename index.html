<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>AR å°è¦½ - å®Œæ•´åŠŸèƒ½ç‰ˆ v2.0</title>
  
  <!-- ========================================
       ğŸ“¦ å¿…è¦çš„ WebAR å‡½å¼åº«
       ======================================== -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
  
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang TC', 'Microsoft JhengHei', sans-serif;
    }
    
    /* ========================================
       ğŸ’¬ æç¤ºè¨Šæ¯æ¨£å¼
       ======================================== */
    #hint {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.85);
      color: white;
      padding: 15px 30px;
      border-radius: 25px;
      z-index: 100;
      font-size: 16px;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: all 0.3s;
    }
    
    /* ========================================
       âš™ï¸ èª¿æ•´æ§åˆ¶é¢æ¿æ¨£å¼
       ======================================== */
    #controls {
      position: fixed;
      top: 60px;
      left: 10px;
      background: rgba(0,0,0,0.92);
      color: white;
      padding: 15px;
      border-radius: 12px;
      font-size: 14px;
      z-index: 200;
      max-width: 220px;
      display: none;
      backdrop-filter: blur(15px);
      box-shadow: 0 4px 25px rgba(0,0,0,0.5);
    }
    
    #controls.visible {
      display: block;
      animation: slideIn 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-30px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
    }
    
    /* æŒ‰éˆ•åŸºç¤æ¨£å¼ */
    #controls button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 14px;
      margin: 3px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 50px;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      font-weight: 500;
    }
    
    #controls button:active {
      transform: scale(0.95) translateY(2px);
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }
    
    #controls button:hover {
      filter: brightness(1.15);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    /* å€å¡Šæ¨™é¡Œæ¨£å¼ */
    #controls .section-title {
      margin: 12px 0 8px 0;
      font-weight: bold;
      color: #a8b3ff;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    #controls .section-title:first-child {
      margin-top: 0;
    }
    
    #controls hr {
      border: none;
      border-top: 1px solid rgba(255,255,255,0.15);
      margin: 12px 0;
    }
    
    /* ç‰¹æ®ŠæŒ‰éˆ•æ¨£å¼ */
    .btn-danger {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
    }
    
    /* ========================================
       ğŸ›ï¸ åˆ‡æ›æŒ‰éˆ•æ¨£å¼
       ======================================== */
    #toggle-btn {
      position: fixed;
      top: 10px;
      right: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 18px;
      z-index: 201;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: all 0.2s;
      font-weight: 600;
    }
    
    #toggle-btn:active {
      transform: scale(0.95);
    }
    
    #toggle-btn:hover {
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }
    
    /* ========================================
       ğŸ“Š è³‡è¨Šé¢æ¿æ¨£å¼
       ======================================== */
    #info {
      position: fixed;
      bottom: 70px;
      left: 10px;
      background: rgba(0,0,0,0.85);
      color: white;
      padding: 12px 14px;
      border-radius: 8px;
      font-family: 'Courier New', 'Consolas', monospace;
      font-size: 11px;
      z-index: 100;
      max-width: 220px;
      line-height: 1.7;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 12px rgba(0,0,0,0.3);
    }
    
    #info strong {
      color: #a8b3ff;
      font-weight: 600;
    }
    
    /* ========================================
       ğŸ”„ è¼‰å…¥ç•«é¢æ¨£å¼
       ======================================== */
    #loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.92);
      color: white;
      padding: 35px 40px;
      border-radius: 15px;
      z-index: 1000;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.5);
    }
    
    #loading.hidden {
      display: none;
    }
    
    /* è¼‰å…¥å‹•ç•« */
    .spinner {
      border: 4px solid rgba(255,255,255,0.2);
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      animation: spin 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
      margin: 0 auto 18px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* ========================================
       ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆ
       ======================================== */
    @media (max-width: 360px) {
      #controls {
        max-width: 180px;
        padding: 12px;
      }
      
      #controls button {
        width: 42px;
        padding: 8px 10px;
        font-size: 14px;
      }
      
      #info {
        font-size: 10px;
        max-width: 180px;
      }
    }
  </style>
</head>
<body>
  
  <!-- ========================================
       ğŸ–¥ï¸ ä½¿ç”¨è€…ä»‹é¢å…ƒç´ 
       ======================================== -->
  
  <!-- è¼‰å…¥ç•«é¢ -->
  <div id="loading">
    <div class="spinner"></div>
    <div style="font-size: 16px; font-weight: 500;">æ­£åœ¨è¼‰å…¥ AR...</div>
  </div>
  
  <!-- æƒææç¤º -->
  <div id="hint">ğŸ“· å°æº–å°è¦½æ¨™èªŒ</div>
  
  <!-- è¨­å®šåˆ‡æ›æŒ‰éˆ• -->
  <button id="toggle-btn">âš™ï¸ è¨­å®š</button>
  
  <!-- èª¿æ•´æ§åˆ¶é¢æ¿ -->
  <div id="controls">
    <div class="section-title">ğŸ“ ä½ç½®èª¿æ•´</div>
    <div style="text-align: center;">
      <button onclick="adjustPos('up')" title="å‘ä¸Šç§»å‹•">â¬†ï¸</button>
    </div>
    <div style="text-align: center;">
      <button onclick="adjustPos('left')" title="å‘å·¦ç§»å‹•">â¬…ï¸</button>
      <button onclick="adjustPos('right')" title="å‘å³ç§»å‹•">â¡ï¸</button>
    </div>
    <div style="text-align: center;">
      <button onclick="adjustPos('down')" title="å‘ä¸‹ç§»å‹•">â¬‡ï¸</button>
    </div>
    <div style="margin: 10px 0; text-align: center;">
      <button onclick="adjustPos('closer')" style="width: auto; padding: 10px 15px;" title="é è¿‘è§€çœ¾">é è¿‘</button>
      <button onclick="adjustPos('farther')" style="width: auto; padding: 10px 15px;" title="é é›¢è§€çœ¾">é é›¢</button>
    </div>
    
    <hr>
    
    <div class="section-title">ğŸ“ å¤§å°èª¿æ•´</div>
    <div style="text-align: center;">
      <button onclick="adjustScale('bigger')" style="width: auto; padding: 10px 15px;" title="æ”¾å¤§å…§å®¹">æ”¾å¤§ +</button>
      <button onclick="adjustScale('smaller')" style="width: auto; padding: 10px 15px;" title="ç¸®å°å…§å®¹">ç¸®å° -</button>
    </div>
    
    <hr>
    
    <div class="section-title">ğŸ”§ æ“ä½œ</div>
    <button onclick="resetPos()" class="btn-danger" style="width: 100%;" title="é‡ç½®æ‰€æœ‰èª¿æ•´">ğŸ”„ é‡ç½®</button>
    <button onclick="saveSettings()" class="btn-success" style="width: 100%; margin-top: 8px;" title="å„²å­˜ç•¶å‰è¨­å®š">ğŸ’¾ å„²å­˜</button>
  </div>
  
  <!-- å³æ™‚è³‡è¨Šé¡¯ç¤º -->
  <div id="info">
    è¼‰å…¥ä¸­...
  </div>

  <!-- ========================================
       ğŸ¬ AR å ´æ™¯è¨­å®š
       ======================================== -->
  <a-scene
    mindar-image="
      imageTargetSrc: https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/image-tracking/assets/card-example/card.mind;
      autoStart: true;
      filterMinCF: 0.0001;
      filterBeta: 0.01;
      missTolerance: 5;
      warmupTolerance: 5;
    "
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true;">

    <!-- ========================================
         ğŸ“¦ è³‡æºå€ï¼šå®šç¾©æ‰€æœ‰è¦ä½¿ç”¨çš„åª’é«”æª”æ¡ˆ
         
         ğŸ”§ å¦‚ä½•ä¿®æ”¹ï¼š
         1. ä¿®æ”¹ video çš„ src ç‚ºä½ çš„å½±ç‰‡ç¶²å€
         2. å¯ä»¥åŠ å…¥å¤šå€‹ video/img/audio æ¨™ç±¤
         ======================================== -->
    <a-assets>
      <!-- ğŸ“¹ å½±ç‰‡è³‡æº -->
      <video 
        id="vid"
        src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
        preload="auto"
        loop="true"
        muted="true"
        crossorigin="anonymous"
        playsinline
        webkit-playsinline>
      </video>
    </a-assets>

    <!-- ç›¸æ©Ÿè¨­å®š -->
    <a-camera 
      position="0 0 0"
      look-controls="enabled: false">
    </a-camera>

    <!-- ========================================
         ğŸ¯ AR å…§å®¹ï¼šç•¶æƒæåˆ°åœ–ç‰‡æ™‚é¡¯ç¤ºçš„å…§å®¹
         ======================================== -->
    <a-entity mindar-image-target="targetIndex: 0">
      
      <!-- ğŸ“¹ å½±ç‰‡å…ƒç´  -->
      <a-video 
        id="ar-video"
        src="#vid" 
        position="0 0 0" 
        width="1" 
        height="0.552">
      </a-video>

      <!-- ğŸ“ æ¨™é¡Œæ–‡å­— -->
      <a-text 
        value="ARV1"//è¼¸å…¥æƒ³è¦çš„æ¨™é¡Œ 
        position="0 0.7 0.01" 
        align="center" 
        color="#FFD700" 
        width="1.5"
        shader="flat">
      </a-text>

    </a-entity>

  </a-scene>

  <!-- ========================================
       ğŸ“œ JavaScript æ ¸å¿ƒç¨‹å¼ç¢¼
       ======================================== -->
  <script>
    // ========================================
    // âš™ï¸ é…ç½®å€ï¼šå¯ä¿®æ”¹çš„åƒæ•¸
    // ========================================
    const CONFIG = {
      autoPlay: true,       // è‡ªå‹•æ’­æ”¾å½±ç‰‡
      loopVideo: true,      // å¾ªç’°æ’­æ”¾
      muteVideo: true,      // éœéŸ³ï¼ˆå¿…é ˆç‚º true æ‰èƒ½è‡ªå‹•æ’­æ”¾ï¼‰
      maxRetries: 3,        // æ’­æ”¾å¤±æ•—é‡è©¦æ¬¡æ•¸
      retryDelay: 500,      // é‡è©¦é–“éš”ï¼ˆæ¯«ç§’ï¼‰
      debug: true,          // é¡¯ç¤ºé™¤éŒ¯è¨Šæ¯
      adjustStep: 0.03,     // ä½ç½®èª¿æ•´æ­¥é€²å€¼
      scaleStep: 1.05       // ç¸®æ”¾èª¿æ•´æ­¥é€²å€¼
    };
    
    // ========================================
    // ğŸ“± è¨­å‚™åµæ¸¬
    // ========================================
    const isAndroid = /Android/i.test(navigator.userAgent);
    const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    const userAgent = navigator.userAgent.toLowerCase();
    
    const deviceInfo = {
      isAndroid: isAndroid,
      isIOS: isIOS,
      isSamsung: userAgent.includes('samsung'),
      isXiaomi: userAgent.includes('xiaomi') || userAgent.includes('redmi'),
      isOPPO: userAgent.includes('oppo'),
      isHuawei: userAgent.includes('huawei'),
      isVivo: userAgent.includes('vivo'),
      screenWidth: window.innerWidth,
      screenHeight: window.innerHeight,
      aspectRatio: (window.innerWidth / window.innerHeight).toFixed(2),
      pixelRatio: window.devicePixelRatio
    };
    
    if (CONFIG.debug) {
      console.log('ğŸ“± è¨­å‚™è³‡è¨Š:', deviceInfo);
    }
    
    // ========================================
    // ğŸ“ èª¿æ•´åƒæ•¸ç®¡ç†
    // ========================================
    let adjustments = {
      position: { x: 0, y: 0, z: 0 },
      scale: { x: 1, y: 1, z: 1 }
    };
    
    // æ ¹æ“šè¨­å‚™é¡å‹é è¨­èª¿æ•´
    if (deviceInfo.isAndroid) {
      const ratio = parseFloat(deviceInfo.aspectRatio);
      
      if (deviceInfo.isSamsung) {
        adjustments.position.y = -0.05;
        adjustments.position.z = 0.02;
        console.log('ğŸ“± å¥—ç”¨ Samsung é è¨­èª¿æ•´');
      } else if (deviceInfo.isXiaomi) {
        adjustments.position.y = -0.03;
        adjustments.scale = { x: 0.95, y: 0.95, z: 0.95 };
        console.log('ğŸ“± å¥—ç”¨ Xiaomi é è¨­èª¿æ•´');
      } else if (deviceInfo.isOPPO || deviceInfo.isVivo) {
        adjustments.position.y = -0.04;
        console.log('ğŸ“± å¥—ç”¨ OPPO/Vivo é è¨­èª¿æ•´');
      } else if (ratio < 0.55) {
        // è¶…é•·è¢å¹• (20:9, 21:9)
        adjustments.position.y = -0.08;
        adjustments.scale = { x: 0.9, y: 0.9, z: 0.9 };
        console.log('ğŸ“± å¥—ç”¨é•·è¢å¹•èª¿æ•´');
      } else if (ratio < 0.6) {
        // é•·è¢å¹• (19.5:9, 19:9)
        adjustments.position.y = -0.05;
        adjustments.scale = { x: 0.95, y: 0.95, z: 0.95 };
        console.log('ğŸ“± å¥—ç”¨ä¸­é•·è¢å¹•èª¿æ•´');
      }
    }
    
    // è¼‰å…¥å„²å­˜çš„è¨­å®š
    const savedSettings = localStorage.getItem('ar-adjustments');
    if (savedSettings) {
      try {
        adjustments = JSON.parse(savedSettings);
        console.log('ğŸ’¾ è¼‰å…¥å„²å­˜çš„è¨­å®š:', adjustments);
      } catch (e) {
        console.warn('âš ï¸ ç„¡æ³•è¼‰å…¥å„²å­˜çš„è¨­å®š:', e);
      }
    }
    
    // ========================================
    // ğŸ”§ èª¿æ•´åŠŸèƒ½å‡½æ•¸
    // ========================================
    
    /**
     * èª¿æ•´ AR å…§å®¹ä½ç½®
     * @param {string} direction - æ–¹å‘: up/down/left/right/closer/farther
     */
    function adjustPos(direction) {
      const step = CONFIG.adjustStep;
      
      switch(direction) {
        case 'up':
          adjustments.position.y += step;
          break;
        case 'down':
          adjustments.position.y -= step;
          break;
        case 'left':
          adjustments.position.x -= step;
          break;
        case 'right':
          adjustments.position.x += step;
          break;
        case 'closer':
          adjustments.position.z += step;
          break;
        case 'farther':
          adjustments.position.z -= step;
          break;
      }
      
      applyAdjustments();
      
      if (CONFIG.debug) {
        console.log(`ğŸ¯ ä½ç½®èª¿æ•´ [${direction}]:`, adjustments.position);
      }
    }
    
    /**
     * èª¿æ•´ AR å…§å®¹å¤§å°
     * @param {string} direction - bigger(æ”¾å¤§) æˆ– smaller(ç¸®å°)
     */
    function adjustScale(direction) {
      const factor = direction === 'bigger' ? CONFIG.scaleStep : (1 / CONFIG.scaleStep);
      
      adjustments.scale.x *= factor;
      adjustments.scale.y *= factor;
      adjustments.scale.z *= factor;
      
      applyAdjustments();
      
      if (CONFIG.debug) {
        console.log(`ğŸ“ å¤§å°èª¿æ•´ [${direction}]:`, adjustments.scale);
      }
    }
    
    /**
     * å¥—ç”¨èª¿æ•´åˆ° AR å…ƒç´ 
     */
    function applyAdjustments() {
      const arVideo = document.querySelector('#ar-video');
      if (!arVideo) {
        console.warn('âš ï¸ æ‰¾ä¸åˆ° AR å½±ç‰‡å…ƒç´ ');
        return;
      }
      
      arVideo.setAttribute('position', adjustments.position);
      arVideo.setAttribute('scale', adjustments.scale);
      
      updateInfo();
    }
    
    /**
     * é‡ç½®æ‰€æœ‰èª¿æ•´
     */
    function resetPos() {
      adjustments = {
        position: { x: 0, y: 0, z: 0 },
        scale: { x: 1, y: 1, z: 1 }
      };
      
      applyAdjustments();
      console.log('ğŸ”„ å·²é‡ç½®æ‰€æœ‰èª¿æ•´');
      
      // é¡¯ç¤ºæç¤º
      const hint = document.getElementById('hint');
      hint.innerHTML = 'âœ… å·²é‡ç½®';
      hint.style.display = 'block';
      setTimeout(() => {
        hint.innerHTML = 'ğŸ“· å°æº–å°è¦½æ¨™èªŒ';
      }, 1500);
    }
    
    /**
     * å„²å­˜ç•¶å‰è¨­å®šåˆ° localStorage
     */
    function saveSettings() {
      try {
        localStorage.setItem('ar-adjustments', JSON.stringify(adjustments));
        alert('ğŸ’¾ è¨­å®šå·²å„²å­˜!');
        console.log('ğŸ’¾ è¨­å®šå·²å„²å­˜:', adjustments);
      } catch (e) {
        console.error('âŒ å„²å­˜å¤±æ•—:', e);
        alert('âŒ å„²å­˜å¤±æ•—');
      }
    }
    
    /**
     * æ›´æ–°è³‡è¨Šé¢æ¿é¡¯ç¤º
     */
    function updateInfo() {
      const info = document.getElementById('info');
      if (!info) return;
      
      const pos = adjustments.position;
      const scale = adjustments.scale;
      
      info.innerHTML = `
        <strong>è¨­å‚™:</strong> ${deviceInfo.isAndroid ? 'Android' : deviceInfo.isIOS ? 'iOS' : 'å…¶ä»–'}<br>
        <strong>è¢å¹•:</strong> ${deviceInfo.screenWidth}x${deviceInfo.screenHeight}<br>
        <strong>æ¯”ä¾‹:</strong> ${deviceInfo.aspectRatio}<br>
        <strong>ä½ç½®:</strong><br>
        &nbsp;&nbsp;X: ${pos.x.toFixed(2)}<br>
        &nbsp;&nbsp;Y: ${pos.y.toFixed(2)}<br>
        &nbsp;&nbsp;Z: ${pos.z.toFixed(2)}<br>
        <strong>å¤§å°:</strong> ${scale.x.toFixed(2)}
      `;
    }
    
    // ========================================
    // ğŸ¥ å½±ç‰‡æ’­æ”¾å‡½æ•¸
    // ========================================
    
    /**
     * å¸¶é‡è©¦æ©Ÿåˆ¶çš„å½±ç‰‡æ’­æ”¾
     */
    async function playVideoWithRetry(video, retries = CONFIG.maxRetries) {
      for (let i = 0; i < retries; i++) {
        try {
          video.muted = CONFIG.muteVideo;
          video.loop = CONFIG.loopVideo;
          
          await video.play();
          
          if (CONFIG.debug) {
            console.log(`âœ… å½±ç‰‡æ’­æ”¾æˆåŠŸ (å˜—è©¦ ${i + 1}/${retries})`);
          }
          
          return true;
        } catch (error) {
          if (CONFIG.debug) {
            console.warn(`âš ï¸ æ’­æ”¾å¤±æ•—ï¼Œå˜—è©¦ ${i + 1}/${retries}:`, error.message);
          }
          
          if (i === retries - 1) {
            console.error('âŒ å½±ç‰‡æ’­æ”¾æœ€çµ‚å¤±æ•—');
            return false;
          }
          
          await new Promise(resolve => setTimeout(resolve, CONFIG.retryDelay));
        }
      }
      return false;
    }
    
    // ========================================
    // ğŸš€ ä¸»è¦åˆå§‹åŒ–å‡½æ•¸
    // ========================================
    
    /**
     * ç­‰å¾…å ´æ™¯è¼‰å…¥
     */
    async function waitForElements() {
      return new Promise((resolve) => {
        const check = () => {
          const scene = document.querySelector('a-scene');
          if (scene && scene.hasLoaded) {
            resolve();
          } else {
            setTimeout(check, 100);
          }
        };
        check();
      });
    }
    
    /**
     * åˆå§‹åŒ– AR æ‡‰ç”¨
     */
    async function initAR() {
      const loading = document.getElementById('loading');
      const hint = document.getElementById('hint');
      
      try {
        if (CONFIG.debug) {
          console.log('ğŸš€ é–‹å§‹åˆå§‹åŒ– AR...');
        }
        
        // ç­‰å¾…å ´æ™¯è¼‰å…¥
        await waitForElements();
        if (CONFIG.debug) {
          console.log('âœ… å ´æ™¯å·²è¼‰å…¥');
        }
        
        // ç²å–å…ƒç´ 
        const target = document.querySelector('[mindar-image-target]');
        const video = document.querySelector('#vid');
        const arVideo = document.querySelector('#ar-video');
        
        // æª¢æŸ¥å…ƒç´ 
        if (!target || !video || !arVideo) {
          throw new Error('æ‰¾ä¸åˆ°å¿…è¦çš„ AR å…ƒç´ ');
        }
        
        // å¥—ç”¨åˆå§‹èª¿æ•´
        applyAdjustments();
        
        // éš±è—è¼‰å…¥ç•«é¢
        loading.classList.add('hidden');
        
        // ç›£è½æ‰¾åˆ°ç›®æ¨™äº‹ä»¶
        target.addEventListener('targetFound', async () => {
          if (CONFIG.debug) {
            console.log('âœ… æ‰¾åˆ°è¿½è¹¤æ¨™è¨˜ï¼');
          }
          
          hint.style.display = 'none';
          
          if (CONFIG.autoPlay) {
            const success = await playVideoWithRetry(video);
            
            if (!success) {
              hint.innerHTML = 'ğŸ‘† é»æ“Šè¢å¹•æ’­æ”¾å½±ç‰‡';
              hint.style.display = 'block';
              
              document.addEventListener('click', async function manualPlay() {
                if (await playVideoWithRetry(video, 1)) {
                  hint.style.display = 'none';
                  document.removeEventListener('click', manualPlay);
                }
              });
            }
          }
        });
        
        // ç›£è½å¤±å»ç›®æ¨™äº‹ä»¶
        target.addEventListener('targetLost', () => {
          if (CONFIG.debug) {
            console.log('âŒ å¤±å»è¿½è¹¤æ¨™è¨˜');
          }
          
          hint.innerHTML = 'ğŸ“· å°æº–å°è¦½æ¨™èªŒ';
          hint.style.display = 'block';
          video.pause();
        });
        
        if (CONFIG.debug) {
          console.log('âœ… AR åˆå§‹åŒ–å®Œæˆ');
        }
        
      } catch (error) {
        console.error('âŒ AR åˆå§‹åŒ–å¤±æ•—:', error);
        
        loading.innerHTML = `
          <div style="color: #ff6b6b;">
            <strong>âŒ è¼‰å…¥å¤±æ•—</strong><br><br>
            ${error.message}<br><br>
            <button onclick="location.reload()" style="
              background: white;
              color: black;
              border: none;
              padding: 12px 24px;
              border-radius: 8px;
              cursor: pointer;
              font-size: 16px;
              font-weight: 600;
            ">ğŸ”„ é‡æ–°è¼‰å…¥</button>
          </div>
        `;
      }
    }
    
    // ========================================
    // ğŸ›ï¸ UI äº‹ä»¶ç›£è½
    // ========================================
    
    // åˆ‡æ›æ§åˆ¶é¢æ¿
    document.getElementById('toggle-btn').addEventListener('click', () => {
      const controls = document.getElementById('controls');
      controls.classList.toggle('visible');
      
      if (CONFIG.debug) {
        console.log('ğŸ›ï¸ æ§åˆ¶é¢æ¿:', controls.classList.contains('visible') ? 'é–‹å•Ÿ' : 'é—œé–‰');
      }
    });
    
    // ========================================
    // ğŸš¨ å…¨åŸŸéŒ¯èª¤è™•ç†
    // ========================================
    
    window.addEventListener('error', (event) => {
      console.error('âŒ å…¨åŸŸéŒ¯èª¤:', event.error);
    });
    
    window.addEventListener('unhandledrejection', (event) => {
      console.error('âŒ æœªè™•ç†çš„ Promise éŒ¯èª¤:', event.reason);
    });
    
    // ========================================
    // ğŸš€ å•Ÿå‹•æ‡‰ç”¨
    // ========================================
    initAR();
    
  </script>

  <!-- ========================================
       ğŸ“š å®Œæ•´ä½¿ç”¨èªªæ˜
       
       ğŸ”§ å¦‚ä½•æ›´æ›è¿½è¹¤åœ–ç‰‡ï¼š
       
       1. æº–å‚™åœ–ç‰‡ï¼ˆ1024x1024 ä»¥ä¸Šï¼Œé«˜å°æ¯”åº¦ï¼‰
       2. ä½¿ç”¨å·¥å…·ç·¨è­¯ç‚º .mind æª”æ¡ˆï¼š
          - ç·šä¸Šå·¥å…·: https://hiukim.github.io/mind-ar-js-doc/tools/compile
          - CLI: mind-ar-cli compile --input img.jpg --output target.mind
       3. ä¿®æ”¹ imageTargetSrc: "./your-target.mind"
       
       ğŸ”§ å¦‚ä½•æ›´æ›å½±ç‰‡ï¼š
       
       1. æº–å‚™ MP4 å½±ç‰‡ï¼ˆH.264, 720p/1080p, <20MBï¼‰
       2. ä¿®æ”¹ <video id="vid" src="./your-video.mp4">
       
       ğŸ”§ å¦‚ä½•åŠ å…¥å¤šå€‹æ™¯é»ï¼š
       
       1. ç·¨è­¯å¤šå¼µåœ–ç‰‡: mind-ar-cli compile --input img1.jpg,img2.jpg --output targets.mind
       2. åŠ å…¥å¤šå€‹ entity:
          <a-entity mindar-image-target="targetIndex: 0">...</a-entity>
          <a-entity mindar-image-target="targetIndex: 1">...</a-entity>
       
       ğŸ¨ èª¿æ•´å»ºè­°ï¼š
       
       - æ–‡å­—é¡è‰²: color="#FF0000"
       - å½±ç‰‡ä½ç½®: position="x y z"
       - å½±ç‰‡å¤§å°: width="1.5" height="0.85"
       - æ—‹è½‰: rotation="0 45 0"
       
       ======================================== -->

</body>
</html>

